	TITLE	'DUP.COM'
; DUP COMMAND  V1 R2
;       Sep.1983 AKIE
;
	EXT	SETFCB,GETFN,PRCRLF,PRSTR
	EXT	CONIN,OPENER,SETDMA,READ
	EXT	MAKEER,WRITER,CLOSER
	EXT	ENDALL
;
REBOOT	EQU	0
BDOS	EQU	5
;
START:	LXI	SP,100H
	LHLD	BDOS+1
	LXI	D,ENDALL
	MOV	A,L
	SUB	E
	MOV	A,H
	SBB	D
	SUI	2
	MOV	L,A
	MVI	H,0
	DAD	H
	SHLD	BLOCKS
;
TRNSF::	LXI	D,FCB1
	CALL	SETFCB
	LXI	D,MES1
	CALL	GETFN
	ORA	A
	JZ	TRNSF
	LXI	D,FCB2
	CALL	SETFCB
	LXI	D,MES2
	CALL	GETFN
	ORA	A
	JZ	TRNSF
	MVI	C,13
	CALL	BDOS
	CALL	PRCRLF
;
	CALL	READBF
	CALL	WRITBF
;
	LXI	D,MES3
	CALL	PRSTR
	CALL	CONIN
	PUSH	PSW
	CALL	PRCRLF
	POP	PSW
	CPI	20H
	JZ	START
	JMP	REBOOT
;
READBF::
	LXI	D,FCB1
	CALL	SETFCB
	CALL	OPENER
	ORA	A
	JZ	0
	LHLD	BLOCKS
	LXI	B,0
	LXI	D,ENDALL
RBF10:	PUSH	H
	PUSH	D
	PUSH	B
	CALL	SETDMA
	CALL	READ
	POP	B
	POP	D
	POP	H
	ORA	A
	JZ	RBF20
	DCX	H
	MOV	A,L
	ANA	H
	INR	A
	JZ	MEMOVR
	INX	B
	PUSH	H
	LXI	H,128
	DAD	D
	XCHG
	POP	H
	JMP	RBF10
;
RBF20:	MOV	L,C
	MOV	H,B
	SHLD	BLOCKS
	RET
;
MEMOVR::
	LXI	D,MES4
	CALL	PRSTR
	JMP	REBOOT
;
WRITBF::
	LXI	D,FCB2
	CALL	SETFCB
	CALL	MAKEER
	ORA	A
	JZ	REBOOT
	LHLD	BLOCKS
	LXI	D,ENDALL
WBF10:	PUSH	H
	PUSH	D
	CALL	SETDMA
	CALL	WRITER
	ORA	A
	JZ	REBOOT
	POP	D
	LXI	H,128
	DAD	D
	XCHG
	POP	H
	DCX	H
	MOV	A,L
	ORA	H
	JNZ	WBF10
	CALL	CLOSER
	ORA	A
	JZ	REBOOT
	RET
;
;
MES1:	DB	'ENTER SOURCE FILE NAME:$'
MES2:	DB	' DISTINATION FILE NAME:$'
MES3:	DB	'PUSH SPACE BAR TO CONTINUE:$'
MES4:	DB	'OUT OF MEMORY!!!$'
;
FCB1::	DS	36
FCB2::	DS	36
BLOCKS:	DS	2
;
ZZZZZZ::
	END
SOURCE FILE NAME:$'
MES2:	DB	' DISTINATION FILE NAME:$'
MES3:	DB	'PUSH SPACE BAR TO CONTINUE:$'
MES4:	DB	'OUT OF MEMORY!!!$' CP 25
 RET Z
 CALL ROMCAL
   DW $664
 EX DE,HL
 LD C,80
DS70:LD (HL),"„"
 INC HL
 DEC C
 JR NZ,DS70
 RET
;
MAIN:CALL CUROFF
 LD A,$20
 OUT ($40),A
 CALL DISP
 XOR A
 OUT ($40),A
 CALL ROMCAL
   DW $F75
 CP $0D
 JP Z,NEXT1
 CP $1F
 J