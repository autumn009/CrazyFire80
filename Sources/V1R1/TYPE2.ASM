	TITLE	'SAMPLE-6 "TYPE2"'
; FROM INTERFACE MAG. '82-12
.Z80
	EXT	SETFCB,ASKFN,OPENER,READ,CONOUT,SETDMA
;
;
	DSEG
	JP	START
;
	CSEG
START:	LD	SP,100H
	LD	DE,5CH
	CALL	SETFCB
; MAKE FCB
	CALL	ASKFN
	AND	A
	JP	Z,0
;OPEN FILE
	CALL	OPENER
	AND	A
	JP	Z,0
	CALL	TYPEFILE
	JP	0
;
TYPEFILE:
	LD	DE,BUFFER
	CALL	SETDMA
	CALL	READ
	AND	A
	RET	Z	;IF EOF
	CALL	TYPE128
	JR	TYPEFILE
;
TYPE128:
	LD	HL,BUFFER
	LD	B,128
TP1:	LD	A,(HL)
	CP	1AH	;EOF MARK
	JP	Z,0	;THEN REBOOT
	LD	E,A
	CALL	CONOUT
	INC	HL
	DJNZ	TP1
	RET
;
	DSEG
;
BUFFER:	DEFS	128
;
	END
128
	JR	TYPEFILE
;
TYPE128:
	LD	HL,BUFFER
	LD	B,128
TP1:	LD	A,(HL)
	CP	1AH	;EOF MARK
	JP	Z,0	;THEN REBOOT
	LD	E,A
	CALE,A
	LD	D,0
	ADD	HL,DE
	LD	(HL),0
	LD	A,1
	POP	HL
	RET
;ERROR RETURN
RCNG:	LD	A,0
	POP	HL
	RET
;
;PRINT STRING
;
PRSTR::			;DE:STRING ADRS
	LD	A,9
	CALL	UBDOS
	RET
;
;DIRECT CONSOLE INPUT/OUTPUT
;
KEEPCH:	DEFS	1
DCINIT::
	LD	A,0
	LD	(KEEPCH),A
	RET
;
DCSTS0:	LD	A,6
	LD	E,0FFH
	CALL	UBDOS
	RET
;
DCSTS::	LD	A,(KEEPCH)
	AND	A
	RET	NZ
	CALL	DCSTS0
	LD	A,(KEEPCH)
	RET
;
DCIN::	CALL	DCSTS
	AND	A
	JR	Z,DCIN
	PUSH	AF
	LD	A,0
	LD	(KEEPCH),A
	POP	AF
	RET
;
DCOUT::	LD	A,6
	CALL	UBDOS
	RET
;
;PRINT CR/LF SUB.
;
PRCRLF::
	PUSH	DE
	LD	E,0DH
	CALL	CONOUT
	LD	E,0AH
	CALL	CONOUT
	POP	DE
	RET
;
FCBA:	DEFS	2	;FCB ADDRESS
;
;	SET FCB ADDRESS SUB.
;
SETFCB::		;ENTRY DE:BLOCK BEGIN
	LD	(FCBA),DE
	RET
;
;	CLEAR FCB SUB.
;
CLEAR:			;ENTRY DE:BLOCK BEGIN
			;A:CLEAR CODE
			;B:CLEAR SIZE
	LD	(DE),A
	INC	DE
	DJNZ	CLEAR
	RET
;
;CLEAR FCB'S DRIVE,FNAME,FTYPE FIELD
;
CLRFCB::
	PUSH	BC
	PUSH	DE
	LD	DE,(FCBA)
	LD	A,0
	INC	DE
	LD	A,20H
	LD	B,8+3
	CALL	CLEAR
	POP	DE
	POP	BC
	RET
;
;CLEAR FCB'S PARAMETER FIELD
;
CLRPMF::
	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	HL,(FCBA)
	LD	DE,1+8+3
	ADD	HL,DE
	EX	DE,HL
	LD	A,0
	LD	B,33-(1+8+3)
	CALL	CLEAR
	POP	HL
	POP	DE
	POP	BC
	RET
;
;CHECK VARID DRIVE N