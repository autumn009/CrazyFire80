; CRAZY-FIRE FITTING PC-8001 MODULE PART-B 
;	 FIT80B V2R3
;	OCT.3,1983
;	   by Akie
SUBTTL CRAZY-FIRE FITTING PC-8001(PART-B) V2R3
.Z80
;
	EXT	DSET,DISPXX,DISPSS,CLRSXX
	EXT	ERROR
	EXT	PTKR1,PTKR2
	EXT	PTBS1,PTBS2,PTBS3
	EXT	PTBSMA,PTSKLU
	EXT	PTBSMB,PTSKU
	EXT	PTBSMC,PTSKLD
	EXT	PTBSMD,PTSKD
	EXT	PTTAK1,PTTAK2
	EXT	BEEPON,BEEPOF
;
	ENTRY	KIRDS,KIRCL,BASEDS,BASECL
	ENTRY	INTDS,INTCL,CRSDS,CRSCL
	ENTRY	DSTDS,DSTCL,BTLDS,BTLCL
	ENTRY	TAKDS,TAKCL
	ENTRY	WMSLDS,WMSLCL
	ENTRY	BTBLA,BTBLB,BTBLC,BTBLD
	ENTRY	SETKRP,SETBSP,SETTKP
;
STEP	EQU	22*2
HSTEP	EQU	STEP/2
;	
IDCODE	EQU	0	
CSCRAL	EQU	1	
SCRAH	EQU	2	
SUBAL	EQU	3	
SUBAH	EQU	4	
YPOS	EQU	5	
XPOS	EQU	6	
SYPOS	EQU	7	
SXPOS	EQU	8	
DX	EQU	9	
DY	EQU	10	
REPCON	EQU	11	
PATAL	EQU	12	
PATAH	EQU	13	
SMOKAL	EQU	14	
SMOKAH	EQU	15	
ENERGL	EQU	16
ENERGH	EQU	17
MSLSL	EQU	18
MSLSH	EQU	19
MODEF	EQU	20
KILLF	EQU	21
;
KIRDS:	CALL	SETKRP
;	RET	NZ
	JR	NZ,KRD100
	INC	(IX+MODEF)
	LD	(IX+REPCON),8
	CALL	DSET
	CALL	DISPSS
	RET
KRD100:	CALL	DSET
	CALL	DISPXX
	RET
;
KIRCL:	PUSH	IX
	LD	DE,0-HSTEP
	ADD	IX,DE
	DEC	(IX+REPCON)
	LD	DE,PTKR1
	LD	(IX+PATAL),E
	LD	(IX+PATAH),D
;	CALL	SETKRP
;	JR	NZ,KRC100
	CALL	DSET
	CALL	CLRSXX
KRC100:	POP	IX
	RET
;
SETKRP:	LD	A,(IX+MODEF)
	BIT	0,A
	LD	DE,PTKR1
	JR	NZ,SKP100
	LD	DE,PTKR2
SKP100:	LD	(IX+PATAL),E
	LD	(IX+PATAH),D
	LD	A,(IX+REPCON)
	OR	A
	RET
;
SETBSP:	LD	A,(IX+REPCON)
	LD	DE,PTBS1
	OR	A
	JR	Z,SBP100
	LD	DE,PTBS2
	DEC	A
	JR	Z,SBP100
	LD	DE,PTBS3
SBP100:	LD	(IX+PATAL),E
	LD	(IX+PATAH),D
	RET
;
BASEDS:	CALL	SETBSP
	CALL	DSET
	CALL	DISPXX
	RET
;
BASECL:	CALL	SETBSP
	CALL	DSET
	CALL	CLRSXX
	RET
;
BTBLA:	DEFB	0
	DEFB	4
;
	DEFB	0-2
	DEFB	0-2
	DEFB	3
	DEFW	PTBSMA
	DEFW	PTSKLU
	DEFB	2
	DEFB	2
;
BTBLB:	DEFB	0
	DEFB	4
;
	DEFB	0
	DEFB	0-2
	DEFB	4
	DEFW	PTBSMB
	DEFW	PTSKU
	DEFB	2
	DEFB	2
;
BTBLC:	DEFB	0
	DEFB	0-4
;
	DEFB	0-2
	DEFB	2
	DEFB	3
	DEFW	PTBSMC
	DEFW	PTSKLD
	DEFB	2
	DEFB	0
;
BTBLD:	DEFB	0
	DEFB	0-4
;
	DEFB	0
	DEFB	2
	DEFB	4
	DEFW	PTBSMD
	DEFW	PTSKD
	DEFB	2
	DEFB	0
;
WMSLDS:	CALL	DSET
	CALL	DISPXX
	RET
;
WMSLCL:	RET
;
TAKDS:	CALL	SETTKP
	CALL	DSET
	CALL	DISPXX
	RET
;
TAKCL:	CALL	SETTKP
	CALL	DSET
	CALL	CLRSXX
	RET
;
SETTKP:	LD	A,(IX+REPCON)
	BIT	1,A
	LD	DE,PTTAK1
	JR	Z,STK100
	LD	DE,PTTAK2
STK100:	LD	(IX+PATAL),E
	LD	(IX+PATAH),D
	RET
;
INTDS:	CALL	DSET
	CALL	DISPXX
	RET
INTCL:	CALL	DSET
	CALL	CLRSXX
	RET
;
DSTDS:
DSTCL:
CRSDS:
CRSCL:
BTLDS:
BTLCL:
	JP	ERROR
;
	END
  000   "
"            000   "
"             000  "
"             000  "
"             000  "
"             000  "
"            0000  "
"           0000   "
"  000     00000   "
"   00000000000    "
"    000000000     "
"      00000       "
"                  "
EOP
PTBMK2
;012345678901234567
"           0      "
"            0     "
"             0    "
"              0   "
"              0   "
"               0  "
"               0  "
"               0  "
"               0  "
"               0  "
"              0   "
"  0           0   "
"   0         0    "
"    00     00     "
"      00000       "
"                  "
EOP
PTKR1
" 0 "
"000"
" 0 "
EOP
PTKR2
" 0 "
"0 0"
" 0 "
EOP
PTBS1
"0000"
"0  0"
"0000"
EOP
PTBS2
"0000"
"0 00"
"0000"
EOP
PTBS3
"0000"
"00 0"
"0000"
EOP
PTBSM
"  0 "
"  0 "
" 000"
"  0 "
EOP
PTINTW
" 000 "
"00000"
"  0  "
"0000 "
EOP
PTINTO
" 000 "
"00000"
EOP
PTINTM
"    "
"0000"
EOP
PTTAK1
"   000  "
"  0 000 "
"0 000000"
" 0000000"
"0 000000"
"   0 0  "
"  0 0 0 "
" 0 0 0 0"
EOP
PTTAK2
"   000  "
"  00000 "
"0 00 000"
"00000000"
"0 000000"
"  0 0 0 "
"  0 0 0 "
"  0 0 0 "
EOP

EOF
LLF)
	OR	A
	JR	Z,CKLEE
	LD	(IX+IDCODE),0
	LD	(IX+KILLF),0
CKLEE:	LD	DE,STEP
	ADD	IX,DE
	JR	CKL100
;
CHIK:	LD	A,(CHIFLG)
	OR	A
	JR	NZ,CHI90
	LD	A,(CHIUND)	
	CP	80	
	JR	NC,CHIUP	
	CP	55
	JR	C,CHIDWN	
	CALL	RND	
	AND	1	
	JR	Z,CHIDWN	
CHIUP