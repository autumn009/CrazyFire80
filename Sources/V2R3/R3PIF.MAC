; PIF(PARAMETER INTERFACE) Rev1.0
;	FOR CRAZY-FIRE & FIT80 V2R3
;  FROM BASIC usr FUNCTION
;	 OCT.3,1983
;	by Akie
SUBTTL PARAMETER INTERFACE FROM NBASIC FOR CRAZY-FIRE
.Z80
	EXT	PAREA
	EXT	ENEERR,TAKERR,RUNERR
	EXT	INTCNT,INTADD
;
	ENTRY	PIF
;
PLEN	EQU	17
;
PIF:	PUSH	DE
	EX	DE,HL
	LD	A,(HL)
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	LD	DE,PAREA
	LD	BC,PLEN
	LDIR
	LD	DE,(INTADD)
	LD	HL,(INTCNT)
	ADD	HL,DE
	LD	(INTCNT),HL
	XOR	A
	LD	(RUNERR),A
	LD	(ENEERR),A
	LD	(TAKERR),A
	POP	DE
	RET
;
	END
,PLEN
	LDIR
	LD	DE,(INTADD)
	LD	HL,(INTCNT)
	ADD	HL,DE
	LD	(INTCNT),HL
	XOR	A
	LD	(RUNERR),A
	LD	(ENEERR),A
	LD	(TAKERRLL	COLCOD
	LD	(CURCOL),A
	LD	DE,89
	CALL	SETCOL
RCL140:	LD	HL,(DRVRAM)
	LD	BC,80
	ADD	HL,BC
	EX	DE,HL
	LD	HL,(DSVRAM)
	ADD	HL,BC
	EX	DE,HL
	LD	A,25
RCL150:	LD	BC,40
	LDIR
	LD	BC,120-40
	ADD	HL,BC
	EX	DE,HL
	ADD	HL,BC
	EX	DE,HL
	DEC	A
	JR	NZ,RCL150
	RET
;
RCL200:	LD	(COLPOS),A
	LD	DE,88
	CALL	SETCOL
	RET
;
COLPOS:	DEFB	10
CURCOL:	DEFB	078H
RCLP:	DEFW	RCLTBL
RCLTBL:	DEFB	2
	DEFB	2
	DEFB	3
	DEFB	3
	DEFB	6
	DEFB	6
	DEFB	4
	DEFB	4
	DEFB	5
	DEFB	5
	DEFB	1
	DEFB	1
	DEFB	0
;
;DISPXX  HL:DRADR,DE:PATTERNADR
;               BC:XY COUNT
DISPXX:			
	PUSH	HL
	PUSH	DE
	LD	DE,(DRVRAM)
	ADD	HL,DE
	POP	DE
DXX100:	PUSH	BC
	PUSH	HL
DXX200:	LD	A,(DE)
	OR	(HL)
	LD	(HL),A
	INC	DE
	INC	HL
	DJNZ	DXX200
	POP	HL
	LD	BC,120
	ADD	HL,BC
	POP	BC
	DEC	C
	JR	NZ,DXX100
	POP	HL
	RET	
;
DISPSS:			
	PUSH	HL
	PUSH	DE
	LD	DE,(DRVRAM)
	ADD	HL,DE
	POP	DE
DSS100:	PUSH	BC
	PUSH	HL
DSS200:	LD	A,20H
	OUT	(40H),A
	LD	A,(DE)
	OR	(HL)
	LD	(HL),A
	INC	DE
	INC	HL
	DJNZ	DSS200
	XOR	A
	OUT	(40H),A
	POP	HL
	LD	BC,120
	ADD	HL,BC
	POP	BC
	DEC	C
	JR	NZ,DSS100
	POP	HL
	RET	
;
CLRSXX:	PUSH	BC
	PUSH	HL
	PUSH	DE
	LD	DE,(DRVRAM)
	ADD	HL,DE
	POP	DE
CXX100:	PUSH	BC
	PUSH	HL
CXX200:	LD	A,(DE)
	CPL
	AND	(HL)
	LD	(HL)